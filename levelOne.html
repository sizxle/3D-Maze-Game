<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>3D maze</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <script src="js/Three.js"></script>
    <script src="js/Three.min.js"></script>
    <script src="js/cannon.js"></script>
    <script src="js/object.js"></script>
    <script src="js/PointerLockControls.js"></script>
    <script src="js/STLLoader.js"></script>
    <div id="count">Level 1: Press start</div>

    <div id="blocker">


        <div id="nextlevel" style="display:none;">
            <span style="font-size:40px">WON</span>
            <br/>Level 2 loading

        </div>

    </div>

    <div id="blocker">


        <div id="gameover" style="display:none;">
            <span style="font-size:40px">GAMEOVER</span>
            <br/>Level Reloading in 3sec

        </div>

    </div>

    <div id="blocker">


        <div id="instructions">
            <span style="font-size:40px">Click to Start</span>
            <br /> (W,A,S,D = Move, SPACE = Jump, MOUSE = Look)
        </div>

    </div>

    <script>
        (function() {
            var script = document.createElement('script');
            script.onload = function() {
                var stats = new Stats();
                document.body.appendChild(stats.dom);
                requestAnimationFrame(function loop() {
                    stats.update();
                    requestAnimationFrame(loop)
                });
            };
            script.src = '//mrdoob.github.io/stats.js/build/stats.min.js';
            document.head.appendChild(script);
        })()
        var sphereShape, sphereBody, world, physicsMaterial, walls = [],
            balls = [],
            ballMeshes = [],
            boxes = [],
            boxMeshes = [];

        let count = 60;
        var interval;

        var camera, scene, renderer;
        var geometry, material, mesh , physicsbody , cubeRef , frameRef ;
        var controls, time = Date.now();

        var blocker = document.getElementById('blocker');
        var instructions = document.getElementById('instructions');
        var gameover = document.getElementById('gameover');
        var nextlevel = document.getElementById('nextlevel');

        var havePointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;

        if (havePointerLock) {

            var element = document.body;
            //if the poiter lock
            var pointerlockchange = function(event) {

                    if (document.pointerLockElement === element || document.mozPointerLockElement === element || document.webkitPointerLockElement === element) {

                        controls.enabled = true;

                        blocker.style.display = 'none';

                        interval = setInterval(function() {
                            document.getElementById('count').innerHTML = count;
                            count--;
                            if (count === 0) {
                                clearInterval(interval);
                                document.getElementById('count').innerHTML = 'GAME OVER';
                                // or...
                                //alert("GAME OVER BABA");
                                //over.style.display = '';
                                blocker.style.display = '-webkit-box';
                                blocker.style.display = '-moz-box';
                                blocker.style.display = 'box';

                                gameover.style.display = '';
                                controls.enabled = false;
                                let reloader = 3;
                                let relo = setInterval(function() {
                                    reloader--
                                    if (reloader === 0) {
                                        location.reload();
                                    }
                                }, 1000);

                            }

                        }, 1000);

                    } else {
                        clearTimeout(interval);
                        controls.enabled = false;

                        blocker.style.display = '-webkit-box';
                        blocker.style.display = '-moz-box';
                        blocker.style.display = 'box';

                        instructions.style.display = '';

                    }

                }
                // if the poiter denied
            var pointerlockerror = function(event) {
                instructions.style.display = '';
            }


            // Hook pointer lock state change events
            document.addEventListener('pointerlockchange', pointerlockchange, false);
            document.addEventListener('mozpointerlockchange', pointerlockchange, false);
            document.addEventListener('webkitpointerlockchange', pointerlockchange, false);

            document.addEventListener('pointerlockerror', pointerlockerror, false);
            document.addEventListener('mozpointerlockerror', pointerlockerror, false);
            document.addEventListener('webkitpointerlockerror', pointerlockerror, false);

            instructions.addEventListener('click', function(event) {
                instructions.style.display = 'none';

                // Ask the browser to lock the pointer
                element.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;

                if (/Firefox/i.test(navigator.userAgent)) {

                    var fullscreenchange = function(event) {

                        if (document.fullscreenElement === element || document.mozFullscreenElement === element || document.mozFullScreenElement === element) {

                            document.removeEventListener('fullscreenchange', fullscreenchange);
                            document.removeEventListener('mozfullscreenchange', fullscreenchange);

                            element.requestPointerLock();
                        }

                    }

                    document.addEventListener('fullscreenchange', fullscreenchange, false);
                    document.addEventListener('mozfullscreenchange', fullscreenchange, false);

                    element.requestFullscreen = element.requestFullscreen || element.mozRequestFullscreen || element.mozRequestFullScreen || element.webkitRequestFullscreen;

                    element.requestFullscreen();




                } else {

                    element.requestPointerLock();

                }

            }, false);


        } else {

            instructions.innerHTML = 'Your browser doesn\'t seem to support Pointer Lock API';

        }

        initCannon();
        init();
        animate();

        function initCannon() {
            // Setup our world
            world = new CANNON.World();
            world.quatNormalizeSkip = 0;
            world.quatNormalizeFast = false;

            var solver = new CANNON.GSSolver();

            world.defaultContactMaterial.contactEquationStiffness = 1e9;
            world.defaultContactMaterial.contactEquationRelaxation = 4;

            solver.iterations = 7;
            solver.tolerance = 0.1;
            var split = true;
            if (split)
                world.solver = new CANNON.SplitSolver(solver);
            else
                world.solver = solver;

            world.gravity.set(0, -20, 0);
            world.broadphase = new CANNON.NaiveBroadphase();

            // Create a slippery material (friction coefficient = 0.0)
            physicsMaterial = new CANNON.Material("slipperyMaterial");
            var physicsContactMaterial = new CANNON.ContactMaterial(physicsMaterial, physicsMaterial, 0.0,
                0.3 // frictioncoefficient
                // restitution
            );
        var mass = 7, radius = 0.5;
        physicsSphere = new CANNON.Sphere(radius);
        physicsbody = new CANNON.Body({ mass: mass });
        physicsbody.addShape(physicsSphere);
        physicsbody.linearDamping = 0.9;
        world.addBody(physicsbody);
            // We must add the contact materials to the world
            world.addContactMaterial(physicsContactMaterial);


            // Create a sphere
            var mass = 5,radius = 0.5;
            sphereShape = new CANNON.Sphere(radius);
            sphereBody = new CANNON.Body({
                mass: mass
            });
            sphereBody.addShape(sphereShape);
            sphereBody.position.set(-2, 5, 53);
            sphereBody.linearDamping = 0.9;
            world.addBody(sphereBody);

            // Create a plane
            var groundShape = new CANNON.Plane();
            var groundBody = new CANNON.Body({
                mass: 0
            });
            groundBody.addShape(groundShape);
            groundBody.quaternion.setFromAxisAngle(new CANNON.Vec3(1, 0, 0), -Math.PI / 2);
            world.addBody(groundBody);
        }

        function init() {

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            //camera.position.set(-50, 50, 100);
            scene = new THREE.Scene();
            // scene.fog = new THREE.Fog("rgb(167, 226, 221)", 0, 50 );

            var ambient = new THREE.AmbientLight("rgb(17, 21, 50)");
            scene.add(ambient);
            //scene.add(camera);
            light = new THREE.SpotLight("rgb(222, 170, 156)");
            light.position.set(10, 100, 20);
            light.target.position.set(5, 0, 55);
            if (true) {
                light.castShadow = true;

                light.shadowCameraNear = 20;
                light.shadowCameraFar = 50; //camera.far;
                light.shadowCameraFov = 40;

                light.shadowMapBias = 0.1;
                light.shadowMapDarkness = 0.7;
                light.shadowMapWidth = 2 * 512;
                light.shadowMapHeight = 2 * 512;

                //light.shadowCameraVisible = true;
            }
            scene.add(light);

            const cubeTextureLoader = new THREE.CubeTextureLoader()
            scene.background = cubeTextureLoader.load([
                "Skybox/1/humble_ft.jpg",
                "Skybox/1/humble_bk.jpg",
                "Skybox/1/humble_up.jpg",
                "Skybox/1/humble_dn.jpg",
                "Skybox/1/humble_rt.jpg",
                "Skybox/1/humble_lf.jpg"
            ])

            var sphere = new THREE.SphereGeometry(0.5, 16, 8);
            light1 = new THREE.PointLight(0xff0040, 2, 50);
            light1.add(new THREE.Mesh(sphere, new THREE.MeshBasicMaterial({
                color: 0xff0040
            })));
            scene.add(light1);
            light2 = new THREE.PointLight(0x0040ff, 2, 50);
            light2.add(new THREE.Mesh(sphere, new THREE.MeshBasicMaterial({
                color: 0x0040ff
            })));
            scene.add(light2);
            light3 = new THREE.PointLight(0x80ff80, 2, 50);
            light3.add(new THREE.Mesh(sphere, new THREE.MeshBasicMaterial({
                color: 0x80ff80
            })));
            scene.add(light3);
            light4 = new THREE.PointLight(0xffaa00, 2, 50);
            light4.add(new THREE.Mesh(sphere, new THREE.MeshBasicMaterial({
                color: 0xffaa00
            })));
            scene.add(light4);


            light1.position.x = 0.5;
            light1.position.y = 4;
            light1.position.z = 8;
            light2.position.x = -60;
            light2.position.y = 4;
            light2.position.z = -30;
            light3.position.x = -70;
            light3.position.y = 4;
            light3.position.z = 50;
            light4.position.x = -40;
            light4.position.y = 4;
            light4.position.z = 0;



            controls = new PointerLockControls(camera, sphereBody);
            scene.add(controls.getObject());
            console.log(controls.getObject().position);




            renderer = new THREE.WebGLRenderer();
            renderer.shadowMapEnabled = true;
            renderer.shadowMapSoft = true;
            renderer.setSize(window.innerWidth, window.innerHeight);
            // renderer.setClearColor( scene.fog.color, 1 );

            document.body.appendChild(renderer.domElement);

            window.addEventListener('resize', onWindowResize, false);


            var x = 1;
            var y = 10;
            var z = 0;

            const geometryIcosa = new THREE.IcosahedronGeometry(0.5, 1);
            const materialGeoIcosa = new THREE.MeshBasicMaterial({
                color: 0xff0080,
                wireframe: true,
                matrixAutoUpdate: false,  //allow to update Matric manually
                needsUpdate: true,

            });
            cubeRef = new THREE.Mesh(geometryIcosa, materialGeoIcosa);
            cubeRef.name = "Cube";
            cubeRef.receiveShadow = true;
            scene.add(cubeRef)
            cubeRef.position.set(0, 20, 0);

            const frameIcosa = new THREE.IcosahedronGeometry(0.5, 1);
            const materialframeIcosa = new THREE.MeshBasicMaterial({
                color: 0xffffff,
                matrixAutoUpdate: false, //allow to update Matric manually
                needsUpdate: true
            });
            frameRef = new THREE.Mesh(frameIcosa, materialframeIcosa);
            frameRef.name = "Framecube";
            scene.add(frameRef);
            frameRef.position.set(0, 20, 0);


            var loader = new THREE.TextureLoader();

            loader.load('grass.png', function(texture) {
                texture.wrapS = THREE.RepeatWrapping;
                texture.wrapT = THREE.RepeatWrapping;
                texture.repeat.set(300, 300);
                var geometry = new THREE.PlaneGeometry(300, 300, 20, 20);
                var material = new THREE.MeshBasicMaterial({
                    map: texture,
                    normalMap: texture,
                    overdraw: 0.5
                });
                var plane = new THREE.Mesh(geometry, material);
                plane.rotation.x = -Math.PI / 2;
                plane.position.y = 0.11111;
                scene.add(plane);
            });

            var wall1 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 100
                },
                position: {
                    x: 0,
                    y: 0,
                    z: 0
                }
            });
            var wall2 = new Box({
                size: {
                    x: x + 96,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -52,
                    y: 0,
                    z: 50
                }
            });
            var wall3 = new Box({
                size: {
                    x: x + 100,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -50,
                    y: 0,
                    z: -50
                }
            });
            var wall4 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 96
                },
                position: {
                    x: -100,
                    y: 0,
                    z: 2
                }
            });

            var wall21 = new Box({
                size: {
                    x: x + 30,
                    y: y,
                    z: z + 30
                },
                position: {
                    x: -50,
                    y: 0,
                    z: 0
                }
            });
            var wall41 = new Box({
                size: {
                    x: x + 20,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -40,
                    y: 0,
                    z: -20
                }
            });
            var wall41 = new Box({
                size: {
                    x: x + 10,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -65,
                    y: 0,
                    z: -20
                }
            });
            var wall41 = new Box({
                size: {
                    x: x + 40,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -50,
                    y: 0,
                    z: 20
                }
            });
            var wall41 = new Box({
                size: {
                    x: x + 50,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -50,
                    y: 0,
                    z: 25
                }
            });
            var wall42 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 40
                },
                position: {
                    x: -70,
                    y: 0,
                    z: 0
                }
            });
            var wall42 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 40
                },
                position: {
                    x: -30,
                    y: 0,
                    z: 0
                }
            });
            var wall42 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 40
                },
                position: {
                    x: -25,
                    y: 0,
                    z: -5
                }
            });
            var wall42 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 5
                },
                position: {
                    x: -25,
                    y: 0,
                    z: 22
                }
            });
            var wall42 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 26
                },
                position: {
                    x: -75,
                    y: 0,
                    z: 12
                }
            });
            var wall42 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 20
                },
                position: {
                    x: -75,
                    y: 0,
                    z: -15
                }
            });
            var wall41 = new Box({
                size: {
                    x: x + 50,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -50,
                    y: 0,
                    z: -25
                }
            });
            var wall41 = new Box({
                size: {
                    x: x + 50,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -50,
                    y: 0,
                    z: -30
                }
            });
            var wall41 = new Box({
                size: {
                    x: x + 60,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -50,
                    y: 0,
                    z: 30
                }
            });

            var wall42 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 55
                },
                position: {
                    x: -80,
                    y: 0,
                    z: -2
                }
            });
            var wall42 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 60
                },
                position: {
                    x: -20,
                    y: 0,
                    z: 0
                }
            });

            var wall41 = new Box({
                size: {
                    x: x + 10,
                    y: y,
                    z: z + 10
                },
                position: {
                    x: -87,
                    y: 0,
                    z: 40
                }
            });
            var wall41 = new Box({
                size: {
                    x: x + 10,
                    y: y,
                    z: z + 10
                },
                position: {
                    x: -10,
                    y: 0,
                    z: -40
                }
            });
            var wall421 = new Box({
                size: {
                    x: x + 50,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -45,
                    y: 0,
                    z: 40
                }
            });
            var wall421 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 50
                },
                position: {
                    x: -10,
                    y: 0,
                    z: 5
                }
            });
            var wall422 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 10
                },
                position: {
                    x: -20,
                    y: 0,
                    z: 35
                }
            });
            var wall422 = new Box({
                size: {
                    x: x + 10,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -15,
                    y: 0,
                    z: 30
                }
            });
            var wall423 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 50
                },
                position: {
                    x: -90,
                    y: 0,
                    z: 5
                }
            });
            var wall424 = new Box({
                size: {
                    x: x + 10,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -85,
                    y: 0,
                    z: 30
                }
            });
            var wall424 = new Box({
                size: {
                    x: x + 20,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -90,
                    y: 0,
                    z: -30
                }
            });
            var wall31 = new Box({
                size: {
                    x: x + 50,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -45,
                    y: 0,
                    z: -40
                }
            });
            var wall311 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 20
                },
                position: {
                    x: -75,
                    y: 0,
                    z: -40
                }
            });
            var wall312 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 10
                },
                position: {
                    x: -20,
                    y: 0,
                    z: -35
                }
            });
            var wall313 = new Box({
                size: {
                    x: x + 3.8,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -78,
                    y: 0,
                    z: 0
                }
            });
            var wall313 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 4
                },
                position: {
                    x: -60,
                    y: 0,
                    z: -27
                }
            });
            var wall313 = new Box({
                size: {
                    x: x + 3.8,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -23,
                    y: 0,
                    z: 22
                }
            });
            var wall313 = new Box({
                size: {
                    x: x + 3.8,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -73,
                    y: 0,
                    z: 15
                }
            });
            var wall313 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 10
                },
                position: {
                    x: -55,
                    y: 0,
                    z: -20
                }
            });
            const texture = new THREE.TextureLoader().load(
                'metallic.jpg');
            var spikes = new THREE.Object3D();
            const Geometryspike1 = new THREE.TetrahedronGeometry(0.2, 0);
            const materialspike1 = new THREE.MeshBasicMaterial({
                //color: 0xff0080,
                //wireframe: true,
                map:texture
            });
            const spike1 = new THREE.Mesh(Geometryspike1, materialspike1);


            const spike2 = spike1.clone();
            const spike3 = spike1.clone();
            spike3.position.set(0, 0, 1);
            spike2.position.set(0, 0, 1.4);
            spike1.position.set(0, 0, 1.8);
            spikes.add(spike1);
            spikes.add(spike2);
            spikes.add(spike3);

            let clonnedspikes1 = spikes.clone();
            let clonnedspikes2 = spikes.clone();
            let clonnedspikes3 = spikes.clone();
            let clonnedspikes4 = spikes.clone();
            let clonnedspikes5 = spikes.clone();
            let clonnedspikes6 = spikes.clone();
            let clonnedspikes7 = spikes.clone();


            spikes.position.set(2.0, 0.1, -1.5);
            clonnedspikes1.position.set(1.5, 0.1, -1.5);
            clonnedspikes2.position.set(1.0, 0.1, -1.5);
            clonnedspikes3.position.set(0.5, 0.1, -1.5);
            clonnedspikes4.position.set(0, 0.1, -1.5);
            clonnedspikes5.position.set(-0.5, 0.1, -1.5);
            clonnedspikes6.position.set(-1, 0.1, -1.5);
            clonnedspikes7.position.set(-1.5, 0.1, -1.5);

            let clonnedSpikes = new THREE.Object3D();
            clonnedSpikes.name = "spikes";
            clonnedSpikes.add(spikes);
            clonnedSpikes.add(clonnedspikes1);
            clonnedSpikes.add(clonnedspikes2);
            clonnedSpikes.add(clonnedspikes3);
            clonnedSpikes.add(clonnedspikes4);
            clonnedSpikes.add(clonnedspikes5);
            clonnedSpikes.add(clonnedspikes6);
            clonnedSpikes.add(clonnedspikes7);
            clonnedSpikes.position.set(3, 0.19999598662591353, 60)


            let spikesObject2 = clonnedSpikes.clone();
            let spikesObject3 = clonnedSpikes.clone();            
            let spikesObject4 = clonnedSpikes.clone();
            let spikesObject5 = clonnedSpikes.clone();
            let spikesObject6 = clonnedSpikes.clone();
            let spikesObject7 = clonnedSpikes.clone();
            let spikesObject8 = clonnedSpikes.clone();
            let spikesObject9 = clonnedSpikes.clone();
            let spikesObject10 = clonnedSpikes.clone();
            let spikesObject11 = clonnedSpikes.clone();
            let spikesObject12 = clonnedSpikes.clone();
            let spikesObject13 = clonnedSpikes.clone();
            let spikesObject14 = clonnedSpikes.clone();
            let spikesObject15 = clonnedSpikes.clone();
            let spikesObject16 = clonnedSpikes.clone();

            scene.add(spikesObject2);
            scene.add(clonnedSpikes);


            let spikebody = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(1.5, 0.2, 0.5)),
                position : new THREE.Vector3(3, 0.19999598662591353, 60)
            });

            let spikebody2 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(1.5, 0.2, 0.5)),
                position: new THREE.Vector3(-5, 0.19999598662591353, 35)
            });
           
            
            spikesObject2.position.copy(spikebody2.position);
            spikesObject2.quaternion.copy(spikebody2.quaternion);
            
            world.addBody(spikebody)
            world.addBody(spikebody2) 


            const boxgeo = new THREE.BoxGeometry(3, 0.4, 1);
            const materialGeo = new THREE.MeshBasicMaterial({
                color: 0xff0080,
                wireframe: true,
            });
            let spikeGeometry = new THREE.Mesh(boxgeo, materialGeo);

            spikeGeometry.position.copy(spikebody.position);
            spikeGeometry.quaternion.copy(spikebody.quaternion);
            scene.add(spikeGeometry);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        var dt = 1 / 60;
        const planeGeo = new THREE.PlaneBufferGeometry(planeSize, planeSize);
        const planeMat = new THREE.MeshPhongMaterial({
            map: texture,
            side: THREE.DoubleSide,
        });
        const mes = new THREE.Mesh(planeGeo, planeMat);
        mesh.receiveShadow = true;
        mesh.rotation.x = Math.PI * -.5;
        scene.add(mes);

        mes.position.x = -2
        mes.position.y = 1
        mes.position.z = 47
        function animate() {

            // let physicsbody = world.bodies[0];
            // let cubeRef = scene.children[8];
            // let frameRef = scene.children[9];

            cubeRef.position.copy(sphereBody.position);
            cubeRef.quaternion.copy(sphereBody.quaternion);
            frameRef.position.copy(sphereBody.position);
            frameRef.quaternion.copy(sphereBody.quaternion);

            requestAnimationFrame(animate);
            if (controls.enabled) {
                world.step(dt);
            }
            if (controls.getObject().position.x <= -101) {
                //alert("won");
                clearTimeout(interval);
                blocker.style.display = '-webkit-box';
                blocker.style.display = '-moz-box';
                blocker.style.display = 'box';

                nextlevel.style.display = '';
                controls.enabled = false;
                let reloader = 3;
                let relo = setInterval(function() {
                    reloader--
                    if (reloader === 0) {
                        location.replace("levelTwo.html")

                        // location.reload();
                    }
                }, 1000);
            }







            //ultimately detect collision between player and obstacle
            sphereBody.addEventListener("collide", function (e) {
                var contact = e.contact;
                console.log(e);
                
                if (contact.bj.id == 40) {
                    sphereBody.position.set(-2, 3, 53);
                    sphereBody.velocity.set(0, 0, 0);
                    controls.getObject().rotation.y = 0;
                    //sphereBody.quaternion.set(0 , 0 , 0 );
                    //console.log(true , sphereBody.position , sphereBody.velocity)
                }
                // contact.bi and contact.bj are the colliding bodies, and contact.ni is the collision normal.
                // We do not yet know which one is which! Let's check.
            });
          
            controls.update(Date.now() - time);
            renderer.render(scene, camera);
            time = Date.now();


        }
    </script>
</body>

</html>