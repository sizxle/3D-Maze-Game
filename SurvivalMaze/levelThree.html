<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>3D maze</title>
    <link href="https://fonts.googleapis.com/css?family=Orbitron" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <script src="js/Three.js"></script>
    <script src="js/Three.min.js"></script>
    <script src="js/cannon.js"></script>
    <script src="js/object.js"></script>
    <script src="js/PointerLockControls.js"></script>
    <script src="js/STLLoader.js"></script>
    <div id="count">Level 3: Press start</div>

    <div id="blocker">


        <div id="nextlevel" style="display:none;">
            <span style="font-size:40px">WON</span>
            <br/>ALL STAGES COMPLETED

        </div>

    </div>

    <div id="blocker">


        <div id="gameover" style="display:none;">
            <span style="font-size:40px">GAMEOVER</span>
            <br/>Level 3 Reloading in 3sec

        </div>

    </div>

    <div id="blocker">


        <div id="instructions">
            <span style="font-size:40px">Click to Start</span>
            <br /> (W,A,S,D = Move, SPACE = Jump, MOUSE = Look)
        </div>

    </div>

    <script>
        (function() {
            var script = document.createElement('script');
            script.onload = function() {
                var stats = new Stats();
                document.body.appendChild(stats.dom);
                requestAnimationFrame(function loop() {
                    stats.update();
                    requestAnimationFrame(loop)
                });
            };
            script.src = '//mrdoob.github.io/stats.js/build/stats.min.js';
            document.head.appendChild(script);
        })()
        var sphereShape, sphereBody, world, physicsMaterial, walls = [],
            balls = [],
            ballMeshes = [],
            boxes = [],
            boxMeshes = [];

        let count = 60;
        var interval;

        var camera, scene, renderer;
        var geometry, material, mesh, physicsbody, cubeRef, frameRef;
        var controls, time = Date.now();

        var blocker = document.getElementById('blocker');
        var instructions = document.getElementById('instructions');
        var gameover = document.getElementById('gameover');
        var nextlevel = document.getElementById('nextlevel');

        var havePointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;

        if (havePointerLock) {

            var element = document.body;
            //if the poiter lock
            var pointerlockchange = function(event) {

                    if (document.pointerLockElement === element || document.mozPointerLockElement === element || document.webkitPointerLockElement === element) {

                        controls.enabled = true;

                        blocker.style.display = 'none';

                        interval = setInterval(function() {
                            document.getElementById('count').innerHTML = "Level 3       TIME:" + count;
                            count--;
                            if (count === 0) {
                                clearInterval(interval);
                                document.getElementById('count').innerHTML = 'GAME OVER';
                                // or...
                                //alert("GAME OVER BABA");
                                //over.style.display = '';
                                blocker.style.display = '-webkit-box';
                                blocker.style.display = '-moz-box';
                                blocker.style.display = 'box';

                                gameover.style.display = '';
                                controls.enabled = false;
                                let reloader = 3;
                                let relo = setInterval(function() {
                                    reloader--
                                    if (reloader === 0) {
                                        location.reload();
                                    }
                                }, 1000);

                            }

                        }, 1000);
                    } else {
                        clearTimeout(interval);
                        controls.enabled = false;

                        blocker.style.display = '-webkit-box';
                        blocker.style.display = '-moz-box';
                        blocker.style.display = 'box';

                        instructions.style.display = '';

                    }

                }
                // if the poiter denied
            var pointerlockerror = function(event) {
                instructions.style.display = '';
            }


            // Hook pointer lock state change events
            document.addEventListener('pointerlockchange', pointerlockchange, false);
            document.addEventListener('mozpointerlockchange', pointerlockchange, false);
            document.addEventListener('webkitpointerlockchange', pointerlockchange, false);

            document.addEventListener('pointerlockerror', pointerlockerror, false);
            document.addEventListener('mozpointerlockerror', pointerlockerror, false);
            document.addEventListener('webkitpointerlockerror', pointerlockerror, false);

            instructions.addEventListener('click', function(event) {
                instructions.style.display = 'none';

                // Ask the browser to lock the pointer
                element.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;

                if (/Firefox/i.test(navigator.userAgent)) {

                    var fullscreenchange = function(event) {

                        if (document.fullscreenElement === element || document.mozFullscreenElement === element || document.mozFullScreenElement === element) {

                            document.removeEventListener('fullscreenchange', fullscreenchange);
                            document.removeEventListener('mozfullscreenchange', fullscreenchange);

                            element.requestPointerLock();
                        }

                    }

                    document.addEventListener('fullscreenchange', fullscreenchange, false);
                    document.addEventListener('mozfullscreenchange', fullscreenchange, false);

                    element.requestFullscreen = element.requestFullscreen || element.mozRequestFullscreen || element.mozRequestFullScreen || element.webkitRequestFullscreen;

                    element.requestFullscreen();




                } else {

                    element.requestPointerLock();

                }

            }, false);


        } else {

            instructions.innerHTML = 'Your browser doesn\'t seem to support Pointer Lock API';

        }

        initCannon();
        init();
        animate();

        function initCannon() {
            // Setup our world
            world = new CANNON.World();
            world.quatNormalizeSkip = 0;
            world.quatNormalizeFast = false;

            var solver = new CANNON.GSSolver();

            world.defaultContactMaterial.contactEquationStiffness = 1e9;
            world.defaultContactMaterial.contactEquationRelaxation = 4;

            solver.iterations = 7;
            solver.tolerance = 0.1;
            var split = true;
            if (split)
                world.solver = new CANNON.SplitSolver(solver);
            else
                world.solver = solver;

            world.gravity.set(0, -20, 0);
            world.broadphase = new CANNON.NaiveBroadphase();

            // Create a slippery material (friction coefficient = 0.0)
            physicsMaterial = new CANNON.Material("slipperyMaterial");
            var physicsContactMaterial = new CANNON.ContactMaterial(physicsMaterial, physicsMaterial, 0.0,
                0.3 // frictioncoefficient
                // restitution
            );
            var mass = 7,
                radius = 0.5;
            physicsSphere = new CANNON.Sphere(radius);
            physicsbody = new CANNON.Body({
                mass: mass
            });
            physicsbody.addShape(physicsSphere);
            physicsbody.linearDamping = 0.9;
            world.addBody(physicsbody);
            // We must add the contact materials to the world
            world.addContactMaterial(physicsContactMaterial);


            // Create a sphere
            var mass = 5,
                radius = 0.5;
            sphereShape = new CANNON.Sphere(radius);
            sphereBody = new CANNON.Body({
                mass: mass
            });
            sphereBody.addShape(sphereShape);
            sphereBody.position.set(-2, 5, 53);
            //sphereBody.position.set(-30, 20, -40);
            sphereBody.linearDamping = 0.9;
            world.addBody(sphereBody);

            // Create a plane
            var groundShape = new CANNON.Plane();
            var groundBody = new CANNON.Body({
                mass: 0
            });
            groundBody.addShape(groundShape);
            groundBody.quaternion.setFromAxisAngle(new CANNON.Vec3(1, 0, 0), -Math.PI / 2);
            world.addBody(groundBody);
        }

        function init() {

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            //camera.position.set(-50, 50, 100);
            scene = new THREE.Scene();
            // scene.fog = new THREE.Fog("rgb(167, 226, 221)", 0, 50 );

            var ambient = new THREE.AmbientLight("rgb(17, 21, 50)");
            scene.add(ambient);
            //scene.add(camera);
            light = new THREE.SpotLight("rgb(222, 170, 156)");
            light.position.set(10, 100, 20);
            light.target.position.set(5, 0, 55);
            if (true) {
                light.castShadow = true;

                light.shadowCameraNear = 20;
                light.shadowCameraFar = 50; //camera.far;
                light.shadowCameraFov = 40;

                light.shadowMapBias = 0.1;
                light.shadowMapDarkness = 0.7;
                light.shadowMapWidth = 2 * 512;
                light.shadowMapHeight = 2 * 512;

                //light.shadowCameraVisible = true;
            }
            scene.add(light);

            const cubeTextureLoader = new THREE.CubeTextureLoader()
            scene.background = cubeTextureLoader.load([
                "Skybox/1/humble_ft.jpg",
                "Skybox/1/humble_bk.jpg",
                "Skybox/1/humble_up.jpg",
                "Skybox/1/humble_dn.jpg",
                "Skybox/1/humble_rt.jpg",
                "Skybox/1/humble_lf.jpg"
            ])

            var sphere = new THREE.SphereGeometry(0.5, 16, 8);
            light1 = new THREE.PointLight(0xff0040, 2, 50);
            light1.add(new THREE.Mesh(sphere, new THREE.MeshBasicMaterial({
                color: 0xff0040
            })));
            scene.add(light1);
            light2 = new THREE.PointLight(0x0040ff, 2, 50);
            light2.add(new THREE.Mesh(sphere, new THREE.MeshBasicMaterial({
                color: 0x0040ff
            })));
            scene.add(light2);
            light3 = new THREE.PointLight(0x80ff80, 2, 50);
            light3.add(new THREE.Mesh(sphere, new THREE.MeshBasicMaterial({
                color: 0x80ff80
            })));
            scene.add(light3);
            light4 = new THREE.PointLight(0xffaa00, 2, 50);
            light4.add(new THREE.Mesh(sphere, new THREE.MeshBasicMaterial({
                color: 0xffaa00
            })));
            scene.add(light4);


            light1.position.x = 0.5;
            light1.position.y = 4;
            light1.position.z = 8;
            light2.position.x = -60;
            light2.position.y = 4;
            light2.position.z = -30;
            light3.position.x = -70;
            light3.position.y = 4;
            light3.position.z = 50;
            light4.position.x = -40;
            light4.position.y = 4;
            light4.position.z = 0;



            controls = new PointerLockControls(camera, sphereBody);
            scene.add(controls.getObject());
            console.log(controls.getObject().position);




            renderer = new THREE.WebGLRenderer();
            renderer.shadowMapEnabled = true;
            renderer.shadowMapSoft = true;
            renderer.setSize(window.innerWidth, window.innerHeight);
            // renderer.setClearColor( scene.fog.color, 1 );

            document.body.appendChild(renderer.domElement);

            window.addEventListener('resize', onWindowResize, false);


            var x = 1;
            var y = 10;
            var z = 0;

            const geometryIcosa = new THREE.IcosahedronGeometry(0.5, 1);
            const materialGeoIcosa = new THREE.MeshBasicMaterial({
                color: 0xff0080,
                wireframe: true,
                matrixAutoUpdate: false, //allow to update Matric manually
                needsUpdate: true,

            });
            cubeRef = new THREE.Mesh(geometryIcosa, materialGeoIcosa);
            cubeRef.name = "Cube";
            cubeRef.receiveShadow = true;
            scene.add(cubeRef)
            cubeRef.position.set(0, 20, 0);

            const frameIcosa = new THREE.IcosahedronGeometry(0.5, 1);
            const materialframeIcosa = new THREE.MeshBasicMaterial({
                color: 0xffffff,
                matrixAutoUpdate: false, //allow to update Matric manually
                needsUpdate: true
            });
            frameRef = new THREE.Mesh(frameIcosa, materialframeIcosa);
            frameRef.name = "Framecube";
            scene.add(frameRef);
            frameRef.position.set(0, 20, 0);


            var loader = new THREE.TextureLoader();

            loader.load('grass.png', function(texture) {
                texture.wrapS = THREE.RepeatWrapping;
                texture.wrapT = THREE.RepeatWrapping;
                texture.repeat.set(300, 300);
                var geometry = new THREE.PlaneGeometry(300, 300, 20, 20);
                var material = new THREE.MeshBasicMaterial({
                    map: texture,
                    normalMap: texture,
                    overdraw: 0.5
                });
                var plane = new THREE.Mesh(geometry, material);
                plane.rotation.x = -Math.PI / 2;
                plane.position.y = 0.11111;
                scene.add(plane);
            });

            var wall1 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 100
                },
                position: {
                    x: 0,
                    y: 0,
                    z: 0
                }
            });
            var wall2 = new Box({
                size: {
                    x: x + 96,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -52,
                    y: 0,
                    z: 50
                }
            });
            var wall3 = new Box({
                size: {
                    x: x + 100,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -50,
                    y: 0,
                    z: -50
                }
            });
            var wall4 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 96
                },
                position: {
                    x: -100,
                    y: 0,
                    z: 2
                }
            });

            var wall21 = new Box({
                size: {
                    x: x + 30,
                    y: y,
                    z: z + 30
                },
                position: {
                    x: -50,
                    y: 0,
                    z: 0
                }
            });
            var wall41 = new Box({
                size: {
                    x: x + 20,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -40,
                    y: 0,
                    z: -20
                }
            });
            var wall41 = new Box({
                size: {
                    x: x + 10,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -65,
                    y: 0,
                    z: -20
                }
            });
            var wall41 = new Box({
                size: {
                    x: x + 40,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -50,
                    y: 0,
                    z: 20
                }
            });
            var wall41 = new Box({
                size: {
                    x: x + 50,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -50,
                    y: 0,
                    z: 25
                }
            });
            var wall42 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 40
                },
                position: {
                    x: -70,
                    y: 0,
                    z: 0
                }
            });
            var wall42 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 40
                },
                position: {
                    x: -30,
                    y: 0,
                    z: 0
                }
            });
            var wall42 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 40
                },
                position: {
                    x: -25,
                    y: 0,
                    z: -5
                }
            });
            var wall42 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 5
                },
                position: {
                    x: -25,
                    y: 0,
                    z: 22
                }
            });
            var wall42 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 26
                },
                position: {
                    x: -75,
                    y: 0,
                    z: 12
                }
            });
            var wall42 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 20
                },
                position: {
                    x: -75,
                    y: 0,
                    z: -15
                }
            });
            var wall41 = new Box({
                size: {
                    x: x + 50,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -50,
                    y: 0,
                    z: -25
                }
            });
            var wall41 = new Box({
                size: {
                    x: x + 50,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -50,
                    y: 0,
                    z: -30
                }
            });
            var wall41 = new Box({
                size: {
                    x: x + 60,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -50,
                    y: 0,
                    z: 30
                }
            });

            var wall42 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 55
                },
                position: {
                    x: -80,
                    y: 0,
                    z: -2
                }
            });
            var wall42 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 60
                },
                position: {
                    x: -20,
                    y: 0,
                    z: 0
                }
            });

            var wall41 = new Box({
                size: {
                    x: x + 10,
                    y: y,
                    z: z + 10
                },
                position: {
                    x: -87,
                    y: 0,
                    z: 40
                }
            });
            var wall41 = new Box({
                size: {
                    x: x + 10,
                    y: y,
                    z: z + 10
                },
                position: {
                    x: -10,
                    y: 0,
                    z: -40
                }
            });
            var wall421 = new Box({
                size: {
                    x: x + 50,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -45,
                    y: 0,
                    z: 40
                }
            });
            var wall421 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 50
                },
                position: {
                    x: -10,
                    y: 0,
                    z: 5
                }
            });
            var wall422 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 10
                },
                position: {
                    x: -20,
                    y: 0,
                    z: 35
                }
            });
            var wall422 = new Box({
                size: {
                    x: x + 10,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -15,
                    y: 0,
                    z: 30
                }
            });
            var wall423 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 50
                },
                position: {
                    x: -90,
                    y: 0,
                    z: 5
                }
            });
            var wall424 = new Box({
                size: {
                    x: x + 10,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -85,
                    y: 0,
                    z: 30
                }
            });
            var wall424 = new Box({
                size: {
                    x: x + 20,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -90,
                    y: 0,
                    z: -30
                }
            });
            var wall31 = new Box({
                size: {
                    x: x + 50,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -45,
                    y: 0,
                    z: -40
                }
            });
            var wall311 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 20
                },
                position: {
                    x: -75,
                    y: 0,
                    z: -40
                }
            });
            var wall312 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 10
                },
                position: {
                    x: -20,
                    y: 0,
                    z: -35
                }
            });
            var wall313 = new Box({
                size: {
                    x: x + 3.8,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -78,
                    y: 0,
                    z: 0
                }
            });
            var wall313 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 4
                },
                position: {
                    x: -60,
                    y: 0,
                    z: -27
                }
            });
            var wall313 = new Box({
                size: {
                    x: x + 3.8,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -23,
                    y: 0,
                    z: 22
                }
            });
            var wall313 = new Box({
                size: {
                    x: x + 3.8,
                    y: y,
                    z: z + 1
                },
                position: {
                    x: -73,
                    y: 0,
                    z: 15
                }
            });
            var wall313 = new Box({
                size: {
                    x: x,
                    y: y,
                    z: z + 10
                },
                position: {
                    x: -55,
                    y: 0,
                    z: -20
                }
            });
            const texture = new THREE.TextureLoader().load(
                'metallic.jpg');
            var spikes = new THREE.Object3D();
            const Geometryspike1 = new THREE.TetrahedronGeometry(0.2, 0);
            const materialspike1 = new THREE.MeshBasicMaterial({
                //color: 0xff0080,
                //wireframe: true,
                map: texture
            });
            const spike1 = new THREE.Mesh(Geometryspike1, materialspike1);


            const spike2 = spike1.clone();
            const spike3 = spike1.clone();
            spike3.position.set(0, 0, 1);
            spike2.position.set(0, 0, 1.4);
            spike1.position.set(0, 0, 1.8);
            spikes.add(spike1);
            spikes.add(spike2);
            spikes.add(spike3);

            let clonnedspikes1 = spikes.clone();
            let clonnedspikes2 = spikes.clone();
            let clonnedspikes3 = spikes.clone();
            let clonnedspikes4 = spikes.clone();
            let clonnedspikes5 = spikes.clone();
            let clonnedspikes6 = spikes.clone();
            let clonnedspikes7 = spikes.clone();


            spikes.position.set(2.0, 0.1, -1.5);
            clonnedspikes1.position.set(1.5, 0.1, -1.5);
            clonnedspikes2.position.set(1.0, 0.1, -1.5);
            clonnedspikes3.position.set(0.5, 0.1, -1.5);
            clonnedspikes4.position.set(0, 0.1, -1.5);
            clonnedspikes5.position.set(-0.5, 0.1, -1.5);
            clonnedspikes6.position.set(-1, 0.1, -1.5);
            clonnedspikes7.position.set(-1.5, 0.1, -1.5);

            let clonnedSpikes = new THREE.Object3D();
            clonnedSpikes.name = "spikes";
            clonnedSpikes.add(spikes);
            clonnedSpikes.add(clonnedspikes1);
            clonnedSpikes.add(clonnedspikes2);
            clonnedSpikes.add(clonnedspikes3);
            clonnedSpikes.add(clonnedspikes4);
            clonnedSpikes.add(clonnedspikes5);
            clonnedSpikes.add(clonnedspikes6);
            clonnedSpikes.add(clonnedspikes7);
            clonnedSpikes.position.set(-4, 0.19999598662591353, 45)


            let spikesObject2 = clonnedSpikes.clone();
            let spikesObject3 = clonnedSpikes.clone();
            let spikesObject4 = clonnedSpikes.clone();
            let spikesObject5 = clonnedSpikes.clone();
            let spikesObject6 = clonnedSpikes.clone();


            spikesObject6.children[0].position.x = 0.0;
            spikesObject6.children[0].position.z = -0.2;
            spikesObject6.children[1].position.x = 0.0;
            spikesObject6.children[1].position.z = 1;
            spikesObject6.children[1].position.z = -2.7;
            spikesObject6.children[2].position.x = 0.0;
            spikesObject6.remove(spikesObject6.children[3])
            spikesObject6.remove(spikesObject6.children[3])
            spikesObject6.remove(spikesObject6.children[3])
            spikesObject6.remove(spikesObject6.children[3])
            spikesObject6.remove(spikesObject6.children[3])
            spikesObject6.remove(spikesObject6.children[3])

            let spikesObject7 = spikesObject6.clone();
            let spikesObject8 = spikesObject6.clone();
            let spikesObject9 = spikesObject6.clone();
            let spikesObject10 = spikesObject6.clone();
            let spikesObject11 = spikesObject6.clone();
            let spikesObject12 = spikesObject6.clone();
            let spikesObject13 = clonnedSpikes.clone();
            let spikesObject14 = clonnedSpikes.clone();
            let spikesObject15 = spikesObject6.clone();
            let spikesObject16 = spikesObject6.clone();
            let spikesObject17 = spikesObject6.clone();
            let spikesObject18 = spikesObject6.clone();
            let spikesObject19 = spikesObject6.clone();
            let spikesObject20 = spikesObject6.clone();
            let spikesObject21 = spikesObject6.clone();
            let spikesObject22 = spikesObject6.clone();
            let spikesObject23 = spikesObject6.clone();
            let spikesObject24 = spikesObject6.clone();
            let spikesObject25 = spikesObject6.clone();
            let spikesObject26 = spikesObject6.clone();
            spikesObject25.remove(spikesObject25.children[0])
            spikesObject25.children[0].position.z = -1;
            spikesObject25.children[1].position.z = -2;
            let spikesObject27 = spikesObject25.clone();
            let spikesObject28 = spikesObject25.clone();
            let spikesObject29 = clonnedSpikes.clone();
            let spikesObject30 = spikesObject6.clone();
            let spikesObject31 = clonnedSpikes.clone();
            let spikesObject32 = clonnedSpikes.clone();
            let spikesObject33 = clonnedSpikes.clone();
            let spikesObject34 = clonnedSpikes.clone();
            let spikesObject35 = spikesObject6.clone();
            let spikesObject36 = clonnedSpikes.clone();
            let spikesObject37 = clonnedSpikes.clone();
            let spikesObject38 = clonnedSpikes.clone();
            let spikesObject39 = clonnedSpikes.clone();
            let spikesObject40 = clonnedSpikes.clone();

            scene.add(spikesObject2);
            scene.add(clonnedSpikes);
            scene.add(spikesObject3);
            scene.add(spikesObject4);
            scene.add(spikesObject5);
            scene.add(spikesObject6);
            scene.add(spikesObject7);
            scene.add(spikesObject8);
            scene.add(spikesObject9);
            scene.add(spikesObject10);
            scene.add(spikesObject11);
            scene.add(spikesObject12);
            scene.add(spikesObject13);
            scene.add(spikesObject14);
            scene.add(spikesObject15);
            scene.add(spikesObject16);
            scene.add(spikesObject17);
            scene.add(spikesObject18);
            scene.add(spikesObject19);
            scene.add(spikesObject20);
            scene.add(spikesObject21);
            scene.add(spikesObject22);
            scene.add(spikesObject23);
            scene.add(spikesObject24);
            scene.add(spikesObject25);
            scene.add(spikesObject26);
            scene.add(spikesObject27);
            scene.add(spikesObject28);
            scene.add(spikesObject29);
            scene.add(spikesObject30);
            scene.add(spikesObject31);
            scene.add(spikesObject32);
            scene.add(spikesObject33);
            scene.add(spikesObject34);
            scene.add(spikesObject35);
            scene.add(spikesObject36);
            scene.add(spikesObject37);
            scene.add(spikesObject38);
            scene.add(spikesObject39);
            scene.add(spikesObject40);
            let spikebody = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(1.5, 0.2, 0.5)),
                position: new THREE.Vector3(-4, 0.19999598662591353, 45)
            });

            let spikebody2 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(1.5, 0.2, 0.5)),
                position: new THREE.Vector3(-4, 0.19999598662591353, -10)
            });

            let spikebody3 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(1.5, 0.2, 0.5)),
                position: new THREE.Vector3(-27.7, 0.19999598662591353, 5)
            });

            let spikebody4 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(1.5, 0.2, 0.5)),
                position: new THREE.Vector3(-7, 0.19999598662591353, 20)
            });

            let spikebody5 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(1.5, 0.2, 0.5)),
                position: new THREE.Vector3(-32.5, 0.19999598662591353, 0)
            });

            let spikebody6 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-20, 0.19999598662591353, 48)
            });

            let spikebody7 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-40, 0.19999598662591353, 46)
            });
            let spikebody8 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-14, 0.19999598662591353, 43)
            });
            let spikebody9 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-30, 0.19999598662591353, 43.0)
            });
            let spikebody10 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-30, 0.19999598662591353, 47.0)
            });

            let spikebody11 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-55, 0.19999598662591353, 43.0)
            });
            let spikebody12 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-55, 0.19999598662591353, 47.0)
            });

            let spikebody13 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(1.5, 0.2, 0.5)),
                position: new THREE.Vector3(-14, 0.19999598662591353, 13)
            });

            let spikebody14 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(1.5, 0.2, 0.5)),
                position: new THREE.Vector3(-22.8, 0.19999598662591353, 10)
            });
            let spikebody15 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-55, 0.19999598662591353, 37)
            });
            let spikebody16 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-35, 0.19999598662591353, 34)
            });
            let spikebody17 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-50, 0.19999598662591353, 28.5)
            });
            let spikebody18 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-30, 0.19999598662591353, 28.5)
            });
            let spikebody19 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-55, 0.19999598662591353, 22)
            });
            let spikebody20 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-35, 0.19999598662591353, 22)
            });
            let spikebody21 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-60, 0.19999598662591353, 18)
            });
            let spikebody22 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-40, 0.19999598662591353, 18)
            });
            let spikebody23 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-50, 0.19999598662591353, -17.0)
            });
            let spikebody24 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-40, 0.19999598662591353, -17.0)
            });
            let spikebody25 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.0)),
                position: new THREE.Vector3(-50, 0.19999598662591353, -23.3)
            });
            let spikebody26 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-40, 0.19999598662591353, -22.5)
            })
            let spikebody27 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-35, 0.19999598662591353, -26.5)
            })
            let spikebody28 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-45, 0.19999598662591353, -28.3)
            })
            let spikebody29 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(1.5, 0.2, 0.5)),
                position: new THREE.Vector3(-60, 0.19999598662591353, -33.5)
            });

            let spikebody30 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-35, 0.19999598662591353, -36)
            });

            let spikebody31 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(1.5, 0.2, 0.5)),
                position: new THREE.Vector3(-50, 0.19999598662591353, -36)
            });
            let spikebody32 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(1.5, 0.2, 0.5)),
                position: new THREE.Vector3(-50, 0.19999598662591353, -42)
            });
            let spikebody33 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(1.5, 0.2, 0.5)),
                position: new THREE.Vector3(-40, 0.19999598662591353, -45)
            });
            let spikebody34 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(1.5, 0.2, 0.5)),
                position: new THREE.Vector3(-30, 0.19999598662591353, -47)
            });
            let spikebody35 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(0.15, 0.25, 1.5)),
                position: new THREE.Vector3(-85, 0.19999598662591353, 47.5)
            });


            let spikebody36 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(1.5, 0.2, 0.5)),
                position: new THREE.Vector3(-73, 0.19999598662591353, -10)
            });

            let spikebody37 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(1.5, 0.2, 0.5)),
                position: new THREE.Vector3(-85, 0.19999598662591353, 10)
            });

            let spikebody38 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(1.5, 0.2, 0.5)),
                position: new THREE.Vector3(-95, 0.19999598662591353, 20)
            });
            let spikebody39 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(1.5, 0.2, 0.5)),
                position: new THREE.Vector3(-77.8, 0.19999598662591353, 3)
            });
            let spikebody40 = new CANNON.Body({
                mass: 1,
                shape: new CANNON.Box(new CANNON.Vec3(1.5, 0.2, 0.5)),
                position: new THREE.Vector3(-68, 0.19999598662591353, 8)
            });

            spikesObject2.position.copy(spikebody2.position);
            spikesObject2.quaternion.copy(spikebody2.quaternion);
            spikesObject3.position.copy(spikebody3.position);
            spikesObject3.quaternion.copy(spikebody3.quaternion);
            spikesObject4.position.copy(spikebody4.position);
            spikesObject4.quaternion.copy(spikebody4.quaternion);
            spikesObject5.position.copy(spikebody5.position);
            spikesObject5.quaternion.copy(spikebody5.quaternion);
            spikesObject6.position.copy(spikebody6.position);
            spikesObject6.quaternion.copy(spikebody6.quaternion);
            spikesObject7.position.copy(spikebody7.position);
            spikesObject7.quaternion.copy(spikebody7.quaternion);
            spikesObject8.position.copy(spikebody8.position);
            spikesObject8.quaternion.copy(spikebody8.quaternion);
            spikesObject9.position.copy(spikebody9.position);
            spikesObject9.quaternion.copy(spikebody9.quaternion);
            spikesObject10.position.copy(spikebody10.position);
            spikesObject10.quaternion.copy(spikebody10.quaternion);
            spikesObject11.position.copy(spikebody11.position);
            spikesObject11.quaternion.copy(spikebody11.quaternion);
            spikesObject12.position.copy(spikebody12.position);
            spikesObject12.quaternion.copy(spikebody12.quaternion);
            spikesObject13.position.copy(spikebody13.position);
            spikesObject13.quaternion.copy(spikebody13.quaternion);
            spikesObject14.position.copy(spikebody14.position);
            spikesObject14.quaternion.copy(spikebody14.quaternion);
            spikesObject15.position.copy(spikebody15.position);
            spikesObject15.quaternion.copy(spikebody15.quaternion);
            spikesObject16.position.copy(spikebody16.position);
            spikesObject16.quaternion.copy(spikebody16.quaternion);
            spikesObject17.position.copy(spikebody17.position);
            spikesObject17.quaternion.copy(spikebody17.quaternion);
            spikesObject18.position.copy(spikebody18.position);
            spikesObject18.quaternion.copy(spikebody18.quaternion);
            spikesObject19.position.copy(spikebody19.position);
            spikesObject19.quaternion.copy(spikebody19.quaternion);
            spikesObject20.position.copy(spikebody20.position);
            spikesObject20.quaternion.copy(spikebody20.quaternion);
            spikesObject21.position.copy(spikebody21.position);
            spikesObject21.quaternion.copy(spikebody21.quaternion);
            spikesObject22.position.copy(spikebody22.position);
            spikesObject22.quaternion.copy(spikebody22.quaternion);
            spikesObject23.position.copy(spikebody23.position);
            spikesObject23.quaternion.copy(spikebody23.quaternion);
            spikesObject24.position.copy(spikebody24.position);
            spikesObject24.quaternion.copy(spikebody24.quaternion);
            spikesObject25.position.copy(spikebody25.position);
            spikesObject25.quaternion.copy(spikebody25.quaternion);
            spikesObject26.position.copy(spikebody26.position);
            spikesObject26.quaternion.copy(spikebody26.quaternion);
            spikesObject27.position.copy(spikebody27.position);
            spikesObject27.quaternion.copy(spikebody27.quaternion);
            spikesObject28.position.copy(spikebody28.position);
            spikesObject28.quaternion.copy(spikebody28.quaternion);
            spikesObject29.position.copy(spikebody29.position);
            spikesObject29.quaternion.copy(spikebody29.quaternion);
            spikesObject30.position.copy(spikebody30.position);
            spikesObject30.quaternion.copy(spikebody30.quaternion);
            spikesObject31.position.copy(spikebody31.position);
            spikesObject31.quaternion.copy(spikebody31.quaternion);
            spikesObject32.position.copy(spikebody32.position);
            spikesObject32.quaternion.copy(spikebody32.quaternion);
            spikesObject33.position.copy(spikebody33.position);
            spikesObject33.quaternion.copy(spikebody33.quaternion);
            spikesObject34.position.copy(spikebody34.position);
            spikesObject34.quaternion.copy(spikebody34.quaternion);
            spikesObject35.position.copy(spikebody35.position);
            spikesObject35.quaternion.copy(spikebody35.quaternion);
            spikesObject36.position.copy(spikebody36.position);
            spikesObject36.quaternion.copy(spikebody36.quaternion);
            spikesObject37.position.copy(spikebody37.position);
            spikesObject37.quaternion.copy(spikebody37.quaternion);
            spikesObject38.position.copy(spikebody38.position);
            spikesObject38.quaternion.copy(spikebody38.quaternion);
            spikesObject39.position.copy(spikebody39.position);
            spikesObject39.quaternion.copy(spikebody39.quaternion);
            spikesObject40.position.copy(spikebody40.position);
            spikesObject40.quaternion.copy(spikebody40.quaternion);
            world.addBody(spikebody)
            world.addBody(spikebody2)
            world.addBody(spikebody3)
            world.addBody(spikebody4)
            world.addBody(spikebody5)
            world.addBody(spikebody6)
            world.addBody(spikebody7)
            world.addBody(spikebody8)
            world.addBody(spikebody9)
            world.addBody(spikebody10)
            world.addBody(spikebody11)
            world.addBody(spikebody12)
            world.addBody(spikebody13)
            world.addBody(spikebody14)
            world.addBody(spikebody15)
            world.addBody(spikebody16)
            world.addBody(spikebody17)
            world.addBody(spikebody18)
            world.addBody(spikebody19)
            world.addBody(spikebody20)
            world.addBody(spikebody21)
            world.addBody(spikebody22)
            world.addBody(spikebody23)
            world.addBody(spikebody24)
            world.addBody(spikebody25)
            world.addBody(spikebody26)
            world.addBody(spikebody27)
            world.addBody(spikebody28)
            world.addBody(spikebody29)
            world.addBody(spikebody30)
            world.addBody(spikebody31)
            world.addBody(spikebody32)
            world.addBody(spikebody33)
            world.addBody(spikebody34)
            world.addBody(spikebody35)
            world.addBody(spikebody36)
            world.addBody(spikebody37)
            world.addBody(spikebody38)
            world.addBody(spikebody39)
            world.addBody(spikebody40)
            console.log(spikebody40)
            const boxgeo = new THREE.BoxGeometry((10, 100, 1));
            const materialGeo = new THREE.MeshBasicMaterial({
                color: 0xff0080,
                wireframe: true,
            });
            let spikeGeometry = new THREE.Mesh(boxgeo, materialGeo);

            spikeGeometry.position.copy(spikebody5.position);
            spikeGeometry.quaternion.copy(spikebody4.quaternion);
            scene.add(spikeGeometry);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        var dt = 1 / 60;
        const planeGeo = new THREE.PlaneBufferGeometry(planeSize, planeSize);
        const planeMat = new THREE.MeshPhongMaterial({
            map: texture,
            side: THREE.DoubleSide,
        });
        const mes = new THREE.Mesh(planeGeo, planeMat);
        mesh.receiveShadow = true;
        mesh.rotation.x = Math.PI * -.5;
        scene.add(mes);

        mes.position.x = -2
        mes.position.y = 1
        mes.position.z = 47

        function animate() {

            // let physicsbody = world.bodies[0];
            // let cubeRef = scene.children[8];
            // let frameRef = scene.children[9];

            cubeRef.position.copy(sphereBody.position);
            cubeRef.quaternion.copy(sphereBody.quaternion);
            frameRef.position.copy(sphereBody.position);
            frameRef.quaternion.copy(sphereBody.quaternion);

            requestAnimationFrame(animate);
            if (controls.enabled) {
                world.step(dt);
            }
            if (controls.getObject().position.x <= -101) {
                //alert("won");
                clearTimeout(interval);
                blocker.style.display = '-webkit-box';
                blocker.style.display = '-moz-box';
                blocker.style.display = 'box';

                nextlevel.style.display = '';
                controls.enabled = false;
                let reloader = 3;
                let relo = setInterval(function() {
                    reloader--
                    if (reloader === 0) {
                        location.replace("index.html")

                        // location.reload();
                    }
                }, 1000);
            }







            //ultimately detect collision between player and obstacle
            sphereBody.addEventListener("collide", function(e) {
                var contact = e.contact;
                console.log(contact.bj.id);

                if (contact.bj.id > 39 && contact.bj.id < 80) {
                    sphereBody.position.set(-2, 3, 53);
                    sphereBody.velocity.set(0, 0, 0);
                    controls.getObject().rotation.y = 0;
                    //sphereBody.quaternion.set(0 , 0 , 0 );
                    //console.log(true , sphereBody.position , sphereBody.velocity)
                    clearInterval(interval);
                    document.getElementById('count').innerHTML = 'GAME OVER';
                    // or...
                    //alert("GAME OVER BABA");
                    //over.style.display = '';
                    blocker.style.display = '-webkit-box';
                    blocker.style.display = '-moz-box';
                    blocker.style.display = 'box';

                    gameover.style.display = '';
                    controls.enabled = false;
                    let reloader = 3;
                    let relo = setInterval(function() {
                        reloader--
                        if (reloader === 0) {
                            location.reload();
                        }
                    }, 1000);

                }
                // contact.bi and contact.bj are the colliding bodies, and contact.ni is the collision normal.
                // We do not yet know which one is which! Let's check.
            });

            controls.update(Date.now() - time);
            renderer.render(scene, camera);
            time = Date.now();


        }
    </script>
</body>

</html>